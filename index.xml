<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Boxcounter的烂笔头</title>
    <link>http://boxcounter.com/index.xml</link>
    <description>Recent content on Boxcounter的烂笔头</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Sat, 26 Nov 2016 00:00:00 +0000</lastBuildDate>
    <atom:link href="http://boxcounter.com/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Host key verification failed的另类触发</title>
      <link>http://boxcounter.com/technique/2016-11-26-Host-key-verification-failed/</link>
      <pubDate>Sat, 26 Nov 2016 00:00:00 +0000</pubDate>
      
      <guid>http://boxcounter.com/technique/2016-11-26-Host-key-verification-failed/</guid>
      <description>

&lt;p&gt;最近几天在编写、测试部署脚本，准备配合Jenkins进行自动化的持续集成，因此需要全程静默执行，未想触发了一个SSH key问题，卡了我好几个小时……&lt;/p&gt;

&lt;h1 id=&#34;问题现象&#34;&gt;问题现象&lt;/h1&gt;

&lt;p&gt;从GitHub上clone过仓库的码农们都知道，用SSH比HTTPs更可靠。但SSH初次连接服务器时，通常会询问是否接受连接，比如这样：&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;The authenticity of host &amp;lsquo;github.com (192.30.252.1)&amp;rsquo; can&amp;rsquo;t be established.&lt;br /&gt;
RSA key fingerprint is 16:27:ac:a5:76:28:2d:36:63:1b:56:4d:eb:df:a6:48.&lt;br /&gt;
Are you sure you want to continue connecting (yes/no)?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;通常大家手输yes就可以继续clone代码了。而静默执行的脚本通常会在建立连接之前将目标站点保存到&lt;code&gt;known_hosts&lt;/code&gt;，以跳过询问。&lt;/p&gt;

&lt;p&gt;在我的脚本里是这样的：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ssh_dir=&amp;quot;${HOME}/.ssh&amp;quot;
...
ssh-keyscan -v -t rsa ssh.github.com &amp;gt; ${ssh_dir}/known_hosts
git clone git@github.com:...
...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;但诡异的是在Jenkins部署过程中并没有生效，还是在建立SSH连接时卡住然后报错「Host key verification failed」。如果打开pty选项，则会如前面那样询问是否接受连接。而在我的本地虚拟机中则完全正常、全程安静地我都不好意思。&lt;/p&gt;

&lt;h1 id=&#34;初步尝试&#34;&gt;初步尝试&lt;/h1&gt;

&lt;p&gt;有怀疑过：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;是不是SSH目录或其中文件的权限设置不对，导致SSH无法读取？&lt;/li&gt;
&lt;li&gt;是不是known_hosts没有生效？格式不对？&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;搜遍资料、试遍方法，几个小时过去了，依然没有进展。眼瞅着就没法轻松过周末了……&lt;/p&gt;

&lt;h1 id=&#34;新思路&#34;&gt;新思路&lt;/h1&gt;

&lt;p&gt;于是换了个思路，跳过Jenkins、直接SSH到被部署服务器上，手动执行脚本：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;chmod u+x ./init.sh
sudo ./init.sh
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;又看到了熟悉的询问，悬着手腕琢磨接下来该怎么办，转念一想「要不yes了看看它自己能不能保存到known_hosts、保存的格式是怎样的」。动手之前先&lt;code&gt;mv known_hosts known_hosts.old&lt;/code&gt;待会好diff。&lt;/p&gt;

&lt;h1 id=&#34;峰回路转&#34;&gt;峰回路转&lt;/h1&gt;

&lt;p&gt;输入yes，峰回路转 —— 并没有生成known_host。&lt;/p&gt;

&lt;p&gt;又陷入思考「难道权限不够？不对啊，我已经sudo了」，一想到sudo，顿时一个激灵 —— 当前是root帐号！赶紧&lt;code&gt;sudo ls -la /root/.ssh/&lt;/code&gt;，果然躺着一个known_hosts文件。&lt;/p&gt;

&lt;p&gt;到此，我才弄明白问题的原因：&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;因为sudo，脚本是以root帐号身份执行，会去&lt;code&gt;/root/.ssh/known_hosts&lt;/code&gt;找known_hosts；&lt;/li&gt;
&lt;li&gt;脚本的ssh-keyscan将ssh.github.com保存进了&lt;code&gt;~/.ssh/known_hosts&lt;/code&gt;，被部署服务器使用的是非root帐号；&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;SSH就没找到ssh-keyscan的结果，所以询问。而之所以在本地虚拟机里一切正常是因为我偷懒用的是root帐号。&lt;/p&gt;

&lt;p&gt;再一细想，我真是糊涂，怎么会整个脚本都sudo呢，这样岂不是git clone等等命令都是以root用户身份执行了吗……&lt;/p&gt;

&lt;h1 id=&#34;解决&#34;&gt;解决&lt;/h1&gt;

&lt;p&gt;找到了问题症结，解决也就简单了，花了十分钟把需要权限的命令都加上sudo，&lt;code&gt;echo xxx &amp;gt; $file&lt;/code&gt;都改成&lt;code&gt;echo xxx | sudo tee $file&lt;/code&gt;，去掉Jenkins构建步骤里的sudo 。&lt;/p&gt;

&lt;p&gt;Jenkins部署成功，欢度周末～&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>macOS tar的特殊行为</title>
      <link>http://boxcounter.com/technique/2016-11-26-macOS%20tar%E7%9A%84%E7%89%B9%E6%AE%8A%E8%A1%8C%E4%B8%BA/</link>
      <pubDate>Sat, 26 Nov 2016 00:00:00 +0000</pubDate>
      
      <guid>http://boxcounter.com/technique/2016-11-26-macOS%20tar%E7%9A%84%E7%89%B9%E6%AE%8A%E8%A1%8C%E4%B8%BA/</guid>
      <description>&lt;p&gt;这周在编写自动部署脚本的过程遇到一个有趣的问题 —— 我把脚本打包成tgz文件，然后scp到被部署服务器上。解压之后发现多出来好些隐藏文件。比如下面的行1和行3：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ ls ./init/letsencrypt/keys/
._0000_key-certbot.pem
0000_key-certbot.pem
._0000_key-letsencrypt.pem
0000_key-letsencrypt.pem
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;一开始我以为是系统自动生成的类似.DS_Store这样的系统文件，但&lt;code&gt;ls -al&lt;/code&gt;看了下源目录，并没有发现踪迹。然后在本机（macOS）上把tgz文件&lt;code&gt;tar zxvf&lt;/code&gt;出来，也没有发现这些文件的存在。&lt;/p&gt;

&lt;p&gt;一头雾水。于是google「tar dot file」，找到了答案：&lt;/p&gt;

&lt;p&gt;macOS自带的tar在打包过程中创建了这些隐藏文件，用于保存被打包文件的扩展属性，解包时会用隐藏文件中的数据重建扩展属性。ubuntu下的tar则不具备这个特性，会将隐藏文件原样解包出来。&lt;/p&gt;

&lt;p&gt;可以通过&lt;code&gt;ls -le@ *&lt;/code&gt;来查看扩展属性：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ /bin/ls -le@ ./init/letsencrypt/keys/
total 56
-rw-------@ 1 Boxcounter  staff  1708 Nov 16 12:26 0000_key-certbot.pem
	com.apple.quarantine	  17
-rw-------@ 1 Boxcounter  staff  1704 Nov 16 12:26 0000_key-letsencrypt.pem
	com.apple.quarantine	  17
-rw-------@ 1 Boxcounter  staff  1704 Nov 16 12:26 0001_key-certbot.pem
	com.apple.quarantine	  17
-rw-------@ 1 Boxcounter  staff  1704 Nov 16 12:26 0001_key-letsencrypt.pem
	com.apple.quarantine	  17
-rw-------@ 1 Boxcounter  staff  1704 Nov 16 12:26 0002_key-certbot.pem
	com.apple.quarantine	  17
-rw-------@ 1 Boxcounter  staff  1704 Nov 16 12:26 0002_key-letsencrypt.pem
	com.apple.quarantine	  17
-rw-------@ 1 Boxcounter  staff  1704 Nov 16 12:26 0003_key-letsencrypt.pem
	com.apple.quarantine	  17
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;解决方法有两种：&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;设置环境变量COPYFILE_DISABLE禁用tar的这个行为：&lt;code&gt;export COPYFILE_DISABLE=1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;改用gnu tar：&lt;code&gt;brew install gnu-tar --with-default-names&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;参考资料：&lt;a href=&#34;http://superuser.com/a/61188&#34;&gt;Why do I get files like ._foo in my tarball on OS X?&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>《经济学原理：宏观经济学》读书笔记</title>
      <link>http://boxcounter.com/reading/2016-10-26-%E7%BB%8F%E6%B5%8E%E5%AD%A6%E5%8E%9F%E7%90%86%EF%BC%9A%E5%AE%8F%E8%A7%82%E7%BB%8F%E6%B5%8E%E5%AD%A6/</link>
      <pubDate>Wed, 26 Oct 2016 00:00:00 +0000</pubDate>
      
      <guid>http://boxcounter.com/reading/2016-10-26-%E7%BB%8F%E6%B5%8E%E5%AD%A6%E5%8E%9F%E7%90%86%EF%BC%9A%E5%AE%8F%E8%A7%82%E7%BB%8F%E6%B5%8E%E5%AD%A6/</guid>
      <description>&lt;p&gt;下图是缩略版本，文末有清晰源图的链接。&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://boxcounter.com/images/2016-10-26/经济学原理：宏观经济学.png&#34;/&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;源文件：&lt;a href=&#34;https://github.com/boxcounter/boxcounter.github.io/raw/master/attachments/2016-10-26/%e7%bb%8f%e6%b5%8e%e5%ad%a6%e5%8e%9f%e7%90%86%ef%bc%9a%e5%ae%8f%e8%a7%82%e7%bb%8f%e6%b5%8e%e5%ad%a6.mindnode.zip&#34;&gt;经济学原理：宏观经济学.mindnode&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;源图：&lt;a href=&#34;https://github.com/boxcounter/boxcounter.github.io/raw/master/attachments/2016-10-26/%e7%bb%8f%e6%b5%8e%e5%ad%a6%e5%8e%9f%e7%90%86%ef%bc%9a%e5%ae%8f%e8%a7%82%e7%bb%8f%e6%b5%8e%e5%ad%a6.png.zip&#34;&gt;经济学原理：宏观经济学.png&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>读书记录</title>
      <link>http://boxcounter.com/reading/2016-04-16-%E8%AF%BB%E4%B9%A6%E8%AE%B0%E5%BD%95/</link>
      <pubDate>Wed, 26 Oct 2016 00:00:00 +0000</pubDate>
      
      <guid>http://boxcounter.com/reading/2016-04-16-%E8%AF%BB%E4%B9%A6%E8%AE%B0%E5%BD%95/</guid>
      <description>

&lt;p&gt;记录我读完的书，从2014年开始记录。主要记录有点厚度的，薄手册和零散资料不记。&lt;/p&gt;

&lt;h1 id=&#34;分类&#34;&gt;分类&lt;/h1&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;评分&lt;/th&gt;
&lt;th&gt;简述&lt;/th&gt;
&lt;th&gt;举例&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;9~10&lt;/td&gt;
&lt;td&gt;经典书籍，值得反复阅读&lt;/td&gt;
&lt;td&gt;《史记》(10)、《TCP/IP详解》(10)&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;7~8&lt;/td&gt;
&lt;td&gt;好书，可能再读&lt;/td&gt;
&lt;td&gt;《大秦帝国》、《明朝那些事儿》、二月河的康雍乾&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;读完有点收获，应该不会再读&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h1 id=&#34;2016年&#34;&gt;2016年&lt;/h1&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;序号&lt;/th&gt;
&lt;th&gt;书名&lt;/th&gt;
&lt;th&gt;作译编者&lt;/th&gt;
&lt;th&gt;读毕日期&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;评分&lt;/th&gt;
&lt;th&gt;其他&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;《布局天下：中国古代军事地理大势》&lt;/td&gt;
&lt;td&gt;饶胜文&lt;/td&gt;
&lt;td&gt;01-12&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;《中国与中国人影像》&lt;/td&gt;
&lt;td&gt;John Thomson&lt;/td&gt;
&lt;td&gt;01-25&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;《壹玖壹壹：从鸦片战争到军阀混战的百年影像史》&lt;/td&gt;
&lt;td&gt;刘香成&lt;/td&gt;
&lt;td&gt;01-31&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;《中国历史风云录》&lt;/td&gt;
&lt;td&gt;陈舜臣&lt;/td&gt;
&lt;td&gt;01-31&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;《古董局中局》&lt;/td&gt;
&lt;td&gt;马伯庸&lt;/td&gt;
&lt;td&gt;02-09&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;《古董局中局：清明上河图之谜》&lt;/td&gt;
&lt;td&gt;马伯庸&lt;/td&gt;
&lt;td&gt;02-10&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;《古董局中局：掠宝清单》&lt;/td&gt;
&lt;td&gt;马伯庸&lt;/td&gt;
&lt;td&gt;02-15&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;《当历史可以观看》&lt;/td&gt;
&lt;td&gt;冯克力&lt;/td&gt;
&lt;td&gt;02-15&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;《一本书读懂中国税》&lt;/td&gt;
&lt;td&gt;言谭&lt;/td&gt;
&lt;td&gt;02-23&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://boxcounter.com/essay/2016-02-23-%E4%B8%80%E6%9C%AC%E4%B9%A6%E8%AF%BB%E6%87%82%E4%B8%AD%E5%9B%BD%E7%A8%8E/&#34;&gt;笔记&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;《古董局中局：大结局》&lt;/td&gt;
&lt;td&gt;马伯庸&lt;/td&gt;
&lt;td&gt;02-26&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;11&lt;/td&gt;
&lt;td&gt;《经济学原理：微观经济学》&lt;/td&gt;
&lt;td&gt;N.Gregory Mankiw&lt;/td&gt;
&lt;td&gt;04-16&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://boxcounter.com/essay/2016-04-16-%e7%bb%8f%e6%b5%8e%e5%ad%a6%e5%8e%9f%e7%90%86%ef%bc%9a%e5%be%ae%e8%a7%82%e7%bb%8f%e6%b5%8e%e5%ad%a6/&#34;&gt;笔记&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;《柏杨版资治通鉴（第29卷 元和中兴·牛李党争）》&lt;/td&gt;
&lt;td&gt;司马光/柏杨&lt;/td&gt;
&lt;td&gt;04-20&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;10&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;13&lt;/td&gt;
&lt;td&gt;《柏杨版资治通鉴（第30卷 甘露事变·大中之治）》&lt;/td&gt;
&lt;td&gt;司马光/柏杨&lt;/td&gt;
&lt;td&gt;04-28&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;10&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;14&lt;/td&gt;
&lt;td&gt;《柏杨版资治通鉴（第31卷 黄巢民变·狼虎谷）》&lt;/td&gt;
&lt;td&gt;司马光/柏杨&lt;/td&gt;
&lt;td&gt;05-01&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;10&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;td&gt;《柏杨版资治通鉴（第32卷 军阀混战·大黑暗）》&lt;/td&gt;
&lt;td&gt;司马光/柏杨&lt;/td&gt;
&lt;td&gt;05-04&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;10&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;《柏杨版资治通鉴（第33卷 五代时代·小分裂）》&lt;/td&gt;
&lt;td&gt;司马光/柏杨&lt;/td&gt;
&lt;td&gt;05-09&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;10&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;17&lt;/td&gt;
&lt;td&gt;《柏杨版资治通鉴（第34卷 千里白骨·半截英雄）》&lt;/td&gt;
&lt;td&gt;司马光/柏杨&lt;/td&gt;
&lt;td&gt;05-13&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;10&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;18&lt;/td&gt;
&lt;td&gt;《柏杨版资治通鉴（第35卷 儿皇帝·横挑强邻）》&lt;/td&gt;
&lt;td&gt;司马光/柏杨&lt;/td&gt;
&lt;td&gt;05-17&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;10&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;19&lt;/td&gt;
&lt;td&gt;《柏杨版资治通鉴（第36卷 高平之战·分裂尾声）》&lt;/td&gt;
&lt;td&gt;司马光/柏杨&lt;/td&gt;
&lt;td&gt;05-21&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;10&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;td&gt;《逻辑思维，只要五步》&lt;/td&gt;
&lt;td&gt;下地宽也&lt;/td&gt;
&lt;td&gt;06-02&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;6&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://boxcounter.com/essay/2016-06-04-%e9%80%bb%e8%be%91%e6%80%9d%e7%bb%b4%ef%bc%8c%e5%8f%aa%e8%a6%81%e4%ba%94%e6%ad%a5/&#34;&gt;笔记&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;21&lt;/td&gt;
&lt;td&gt;《Redis实战》&lt;/td&gt;
&lt;td&gt;Josiah L. Carlson/黄健宏&lt;/td&gt;
&lt;td&gt;08-03&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;22&lt;/td&gt;
&lt;td&gt;《暗时间》&lt;/td&gt;
&lt;td&gt;刘未鹏&lt;/td&gt;
&lt;td&gt;08-20&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;6&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;23&lt;/td&gt;
&lt;td&gt;《我想重新解释历史》&lt;/td&gt;
&lt;td&gt;吴思&lt;/td&gt;
&lt;td&gt;08-21&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;24&lt;/td&gt;
&lt;td&gt;《设计原本》&lt;/td&gt;
&lt;td&gt;Frederick P. Brooks/高博、朱磊、王海鹏&lt;/td&gt;
&lt;td&gt;09-04&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;25&lt;/td&gt;
&lt;td&gt;《乌合之众》&lt;/td&gt;
&lt;td&gt;Gustave Le Bon/冯克利&lt;/td&gt;
&lt;td&gt;10-05&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;26&lt;/td&gt;
&lt;td&gt;《构建高性能Web站点》&lt;/td&gt;
&lt;td&gt;郭欣&lt;/td&gt;
&lt;td&gt;10-11&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;27&lt;/td&gt;
&lt;td&gt;《The Logstash Book v2.3.2》&lt;/td&gt;
&lt;td&gt;James Turnbull&lt;/td&gt;
&lt;td&gt;10-12&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;6&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;28&lt;/td&gt;
&lt;td&gt;《大型网站技术架构》&lt;/td&gt;
&lt;td&gt;李智慧&lt;/td&gt;
&lt;td&gt;10-21&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;29&lt;/td&gt;
&lt;td&gt;《经济学原理：宏观经济学》&lt;/td&gt;
&lt;td&gt;N.Gregory Mankiw&lt;/td&gt;
&lt;td&gt;10-26&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://boxcounter.com/reading_notes/2016-10-26-%e7%bb%8f%e6%b5%8e%e5%ad%a6%e5%8e%9f%e7%90%86%ef%bc%9a%e5%ae%8f%e8%a7%82%e7%bb%8f%e6%b5%8e%e5%ad%a6/&#34;&gt;笔记&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;30&lt;/td&gt;
&lt;td&gt;《品人录》&lt;/td&gt;
&lt;td&gt;易中天&lt;/td&gt;
&lt;td&gt;12-08&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h1 id=&#34;2015年&#34;&gt;2015年&lt;/h1&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;序号&lt;/th&gt;
&lt;th&gt;书名&lt;/th&gt;
&lt;th&gt;作译编者&lt;/th&gt;
&lt;th&gt;读毕日期&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;评分&lt;/th&gt;
&lt;th&gt;其他&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;《南渡北归：南渡（上）》&lt;/td&gt;
&lt;td&gt;岳南&lt;/td&gt;
&lt;td&gt;01-13&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;《浪潮之巅(第2版)（上）》&lt;/td&gt;
&lt;td&gt;吴军&lt;/td&gt;
&lt;td&gt;01-27&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;《南渡北归：南渡（下）》&lt;/td&gt;
&lt;td&gt;岳南&lt;/td&gt;
&lt;td&gt;01-29&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;《南渡北归：北归（上）》&lt;/td&gt;
&lt;td&gt;岳南&lt;/td&gt;
&lt;td&gt;02-07&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;《南渡北归：北归（下）》&lt;/td&gt;
&lt;td&gt;岳南&lt;/td&gt;
&lt;td&gt;02-16&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;《南渡北归：离别（上）》&lt;/td&gt;
&lt;td&gt;岳南&lt;/td&gt;
&lt;td&gt;02-19&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;《南渡北归：离别（下）》&lt;/td&gt;
&lt;td&gt;岳南&lt;/td&gt;
&lt;td&gt;03-01&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;《失控》&lt;/td&gt;
&lt;td&gt;Kevin Kelly&lt;/td&gt;
&lt;td&gt;04-06&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;6&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;《浪潮之巅(第2版)（下）》&lt;/td&gt;
&lt;td&gt;吴军&lt;/td&gt;
&lt;td&gt;04-08&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;《饥饿的盛世》&lt;/td&gt;
&lt;td&gt;张宏杰&lt;/td&gt;
&lt;td&gt;04-12&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;11&lt;/td&gt;
&lt;td&gt;《柏杨版资治通鉴（第25卷 恐怖世界·恶妻恶女）》&lt;/td&gt;
&lt;td&gt;司马光/柏杨&lt;/td&gt;
&lt;td&gt;04-28&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;10&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;《柏杨版资治通鉴（第26卷 开元盛世·范阳兵变）》&lt;/td&gt;
&lt;td&gt;司马光/柏杨&lt;/td&gt;
&lt;td&gt;05-11&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;10&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;13&lt;/td&gt;
&lt;td&gt;《柏杨版资治通鉴（第27卷 睢阳之围·皇后失踪）》&lt;/td&gt;
&lt;td&gt;司马光/柏杨&lt;/td&gt;
&lt;td&gt;05-20&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;10&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;14&lt;/td&gt;
&lt;td&gt;《文明之光（上）》&lt;/td&gt;
&lt;td&gt;吴军&lt;/td&gt;
&lt;td&gt;06-02&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;9&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;td&gt;《柏杨版资治通鉴（第28卷 泾原兵变·猪皇帝）》&lt;/td&gt;
&lt;td&gt;司马光/柏杨&lt;/td&gt;
&lt;td&gt;06-04&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;10&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;《投机者的扑克》&lt;/td&gt;
&lt;td&gt;扁虫鱼&lt;/td&gt;
&lt;td&gt;06-16&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;6&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;17&lt;/td&gt;
&lt;td&gt;《三体》&lt;/td&gt;
&lt;td&gt;刘慈欣&lt;/td&gt;
&lt;td&gt;06-23&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;18&lt;/td&gt;
&lt;td&gt;《炒股的智慧》&lt;/td&gt;
&lt;td&gt;陈江挺&lt;/td&gt;
&lt;td&gt;06-29&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;6&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;19&lt;/td&gt;
&lt;td&gt;《文明之光（中）》&lt;/td&gt;
&lt;td&gt;吴军&lt;/td&gt;
&lt;td&gt;07-03&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;9&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;td&gt;《三体：黑暗森林》&lt;/td&gt;
&lt;td&gt;刘慈欣&lt;/td&gt;
&lt;td&gt;07-07&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;21&lt;/td&gt;
&lt;td&gt;《一课经济学》&lt;/td&gt;
&lt;td&gt;Henry Hazlitt&lt;/td&gt;
&lt;td&gt;07-14&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;22&lt;/td&gt;
&lt;td&gt;《怦然心动的人生整理魔法》&lt;/td&gt;
&lt;td&gt;近藤麻理惠&lt;/td&gt;
&lt;td&gt;07-14&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;6&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;23&lt;/td&gt;
&lt;td&gt;《三体：死神永生》&lt;/td&gt;
&lt;td&gt;刘慈欣&lt;/td&gt;
&lt;td&gt;07-17&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;24&lt;/td&gt;
&lt;td&gt;《怦然心动的人生整理魔法2》&lt;/td&gt;
&lt;td&gt;近藤麻理惠&lt;/td&gt;
&lt;td&gt;07-22&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;6&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;25&lt;/td&gt;
&lt;td&gt;《茶艺师：基础知识》&lt;/td&gt;
&lt;td&gt;陈文华&lt;/td&gt;
&lt;td&gt;07-28&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;6&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;26&lt;/td&gt;
&lt;td&gt;《曾国藩：血祭》&lt;/td&gt;
&lt;td&gt;唐浩明&lt;/td&gt;
&lt;td&gt;08-07&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;27&lt;/td&gt;
&lt;td&gt;《从来就没有救世主》&lt;/td&gt;
&lt;td&gt;许小年&lt;/td&gt;
&lt;td&gt;08-08&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://boxcounter.com/essay/2015-08-08-%E4%BB%8E%E6%9D%A5%E5%B0%B1%E6%B2%A1%E6%9C%89%E6%95%91%E4%B8%96%E4%B8%BB/&#34;&gt;笔记&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;28&lt;/td&gt;
&lt;td&gt;《曾国藩：野焚》&lt;/td&gt;
&lt;td&gt;唐浩明&lt;/td&gt;
&lt;td&gt;08-14&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;29&lt;/td&gt;
&lt;td&gt;《文明之光（下）》&lt;/td&gt;
&lt;td&gt;吴军&lt;/td&gt;
&lt;td&gt;08-18&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;9&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;30&lt;/td&gt;
&lt;td&gt;《曾国藩：黑雨》&lt;/td&gt;
&lt;td&gt;唐浩明&lt;/td&gt;
&lt;td&gt;08-26&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;31&lt;/td&gt;
&lt;td&gt;《真实世界的经济学》&lt;/td&gt;
&lt;td&gt;周其仁&lt;/td&gt;
&lt;td&gt;09-09&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;http://boxcounter.com/essay/2015-09-09-%E7%9C%9F%E5%AE%9E%E4%B8%96%E7%95%8C%E7%9A%84%E7%BB%8F%E6%B5%8E%E5%AD%A6/&#34;&gt;笔记&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;32&lt;/td&gt;
&lt;td&gt;《大明王朝的七张面孔》&lt;/td&gt;
&lt;td&gt;张宏杰&lt;/td&gt;
&lt;td&gt;09-09&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;33&lt;/td&gt;
&lt;td&gt;《白门柳：夕阳芳草》&lt;/td&gt;
&lt;td&gt;刘斯奋&lt;/td&gt;
&lt;td&gt;09-17&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;34&lt;/td&gt;
&lt;td&gt;《费城风云：美国宪法的诞生和我们的反思》&lt;/td&gt;
&lt;td&gt;易中天&lt;/td&gt;
&lt;td&gt;09-23&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;35&lt;/td&gt;
&lt;td&gt;《白门柳：秋露危城》&lt;/td&gt;
&lt;td&gt;刘斯奋&lt;/td&gt;
&lt;td&gt;09-24&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;36&lt;/td&gt;
&lt;td&gt;《白门柳：鸡鸣风雨》&lt;/td&gt;
&lt;td&gt;刘斯奋&lt;/td&gt;
&lt;td&gt;10-20&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;37&lt;/td&gt;
&lt;td&gt;《不要因为走得太远而忘记为什么出发》&lt;/td&gt;
&lt;td&gt;徐泓&lt;/td&gt;
&lt;td&gt;10-29&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;6&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;38&lt;/td&gt;
&lt;td&gt;《悠悠南北朝：宋齐北魏的纷争史》&lt;/td&gt;
&lt;td&gt;陈羡&lt;/td&gt;
&lt;td&gt;11-16&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;39&lt;/td&gt;
&lt;td&gt;《悠悠南北朝：三国归隋的统一路》&lt;/td&gt;
&lt;td&gt;陈羡&lt;/td&gt;
&lt;td&gt;12-07&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;40&lt;/td&gt;
&lt;td&gt;《纵横十六国》&lt;/td&gt;
&lt;td&gt;陈羡&lt;/td&gt;
&lt;td&gt;12-31&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h1 id=&#34;2014年&#34;&gt;2014年&lt;/h1&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;序号&lt;/th&gt;
&lt;th&gt;书名&lt;/th&gt;
&lt;th&gt;作译编者&lt;/th&gt;
&lt;th&gt;读毕日期&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;评分&lt;/th&gt;
&lt;th&gt;其他&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;《代码大全》&lt;/td&gt;
&lt;td&gt;Steve McConnell&lt;/td&gt;
&lt;td&gt;1月&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;9&lt;/td&gt;
&lt;td&gt;3rd&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;《高效程序员的45个习惯：敏捷开发修炼之道》&lt;/td&gt;
&lt;td&gt;Venkat Subramaniam / Andy Hunt&lt;/td&gt;
&lt;td&gt;1月&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;《黑客与画家》&lt;/td&gt;
&lt;td&gt;Paul Graham&lt;/td&gt;
&lt;td&gt;2月&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;《代码的未来》&lt;/td&gt;
&lt;td&gt;松本行弘&lt;/td&gt;
&lt;td&gt;2月&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;6&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;《MacTalk·人生元编程（纸版）》&lt;/td&gt;
&lt;td&gt;池建强&lt;/td&gt;
&lt;td&gt;2月&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;6&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;《柏杨版资治通鉴》&lt;/td&gt;
&lt;td&gt;司马光/柏杨&lt;/td&gt;
&lt;td&gt;0101刘宋， 0301陈后主即将上台&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;10&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;《给你一个团队，你能怎么管？》&lt;/td&gt;
&lt;td&gt;赵伟&lt;/td&gt;
&lt;td&gt;03-07&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;5&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;《程序员的职业素养》&lt;/td&gt;
&lt;td&gt;Robert C.Martin&lt;/td&gt;
&lt;td&gt;03-14&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;9&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;《殷商玛雅征服史》&lt;/td&gt;
&lt;td&gt;马伯庸&lt;/td&gt;
&lt;td&gt;03-24&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;5&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;《关键对话：如何高效能沟通》&lt;/td&gt;
&lt;td&gt;Kerry Patterson/Joseph Grenny/Ron McMillan&lt;/td&gt;
&lt;td&gt;03-26&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;11&lt;/td&gt;
&lt;td&gt;《简约至上》&lt;/td&gt;
&lt;td&gt;Giles Colborne&lt;/td&gt;
&lt;td&gt;04-01&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;《帝国最后的荣耀》&lt;/td&gt;
&lt;td&gt;马伯庸/汗青&lt;/td&gt;
&lt;td&gt;04-07&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;13&lt;/td&gt;
&lt;td&gt;《浪潮之巅（第一版）》&lt;/td&gt;
&lt;td&gt;吴军&lt;/td&gt;
&lt;td&gt;04-17&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;14&lt;/td&gt;
&lt;td&gt;《项目管理修炼之道》&lt;/td&gt;
&lt;td&gt;Johanna Rothman&lt;/td&gt;
&lt;td&gt;04-27&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;td&gt;《Android开发精要》&lt;/td&gt;
&lt;td&gt;范怀宇&lt;/td&gt;
&lt;td&gt;05-15&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;《代码整洁之道》&lt;/td&gt;
&lt;td&gt;Robert C.Martin&lt;/td&gt;
&lt;td&gt;05-21&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;17&lt;/td&gt;
&lt;td&gt;《三国机密》&lt;/td&gt;
&lt;td&gt;马伯庸&lt;/td&gt;
&lt;td&gt;05-30&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;18&lt;/td&gt;
&lt;td&gt;《我读书少你可别骗我》&lt;/td&gt;
&lt;td&gt;马伯庸&lt;/td&gt;
&lt;td&gt;06-03&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;5&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;19&lt;/td&gt;
&lt;td&gt;《精益开发实战》&lt;/td&gt;
&lt;td&gt;Henrik Kniberg&lt;/td&gt;
&lt;td&gt;06-24&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;td&gt;《鬼吹灯（全）》&lt;/td&gt;
&lt;td&gt;天下霸唱&lt;/td&gt;
&lt;td&gt;06-29&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;6&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;21&lt;/td&gt;
&lt;td&gt;《重来:更为简单有效的商业思维》&lt;/td&gt;
&lt;td&gt;Jason Fried/David Heinemeier Hansson&lt;/td&gt;
&lt;td&gt;07-03&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;22&lt;/td&gt;
&lt;td&gt;《悟空传·完美纪念版》&lt;/td&gt;
&lt;td&gt;今何在&lt;/td&gt;
&lt;td&gt;07-03&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;23&lt;/td&gt;
&lt;td&gt;《风起陇西》&lt;/td&gt;
&lt;td&gt;马伯庸&lt;/td&gt;
&lt;td&gt;07-07&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;24&lt;/td&gt;
&lt;td&gt;《一座城池》&lt;/td&gt;
&lt;td&gt;韩寒&lt;/td&gt;
&lt;td&gt;07-11&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;6&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;25&lt;/td&gt;
&lt;td&gt;《人月神话（32周年中文纪念版）》&lt;/td&gt;
&lt;td&gt;Frederick P.Brooks.Jr&lt;/td&gt;
&lt;td&gt;07-14&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;9&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;26&lt;/td&gt;
&lt;td&gt;《程序员的思维修炼》&lt;/td&gt;
&lt;td&gt;Andy Hunt&lt;/td&gt;
&lt;td&gt;07-21&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;27&lt;/td&gt;
&lt;td&gt;《柏杨版资治通鉴（第21卷 突厥可汗·南北统一）》&lt;/td&gt;
&lt;td&gt;司马光/柏杨&lt;/td&gt;
&lt;td&gt;08-03&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;10&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;28&lt;/td&gt;
&lt;td&gt;《柏杨版资治通鉴（第22卷 官逼民反·江都政变）》&lt;/td&gt;
&lt;td&gt;司马光/柏杨&lt;/td&gt;
&lt;td&gt;08-17&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;10&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;29&lt;/td&gt;
&lt;td&gt;《参与感》&lt;/td&gt;
&lt;td&gt;黎万强&lt;/td&gt;
&lt;td&gt;08-22&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;30&lt;/td&gt;
&lt;td&gt;《柏杨版资治通鉴（第23卷 玄武门·贞观之治）》&lt;/td&gt;
&lt;td&gt;司马光/柏杨&lt;/td&gt;
&lt;td&gt;09-02&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;10&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;31&lt;/td&gt;
&lt;td&gt;《柏杨版资治通鉴（第24卷 黄金时代·武后夺权）》&lt;/td&gt;
&lt;td&gt;司马光/柏杨&lt;/td&gt;
&lt;td&gt;09-07&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;10&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;32&lt;/td&gt;
&lt;td&gt;《南明那些事儿》&lt;/td&gt;
&lt;td&gt;洪兵&lt;/td&gt;
&lt;td&gt;09-18&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;33&lt;/td&gt;
&lt;td&gt;《敏捷软件开发——原则、模式与实践》&lt;/td&gt;
&lt;td&gt;Robert C·Martin&lt;/td&gt;
&lt;td&gt;09-21&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;9&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;34&lt;/td&gt;
&lt;td&gt;《人件》&lt;/td&gt;
&lt;td&gt;Tom DeMarco/Timothy Lister&lt;/td&gt;
&lt;td&gt;09-28&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;9&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;35&lt;/td&gt;
&lt;td&gt;《最简单的图形与最复杂的信息》&lt;/td&gt;
&lt;td&gt;黄慧敏&lt;/td&gt;
&lt;td&gt;10-09&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;7&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;36&lt;/td&gt;
&lt;td&gt;《敏捷武士——看敏捷高手交付卓越软件》&lt;/td&gt;
&lt;td&gt;Jonathan　Rasmusson&lt;/td&gt;
&lt;td&gt;10月&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;37&lt;/td&gt;
&lt;td&gt;《红顶商人胡雪岩》&lt;/td&gt;
&lt;td&gt;高阳&lt;/td&gt;
&lt;td&gt;12-09&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;8&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
</description>
    </item>
    
    <item>
      <title>《逻辑思维，只要五步》读书笔记</title>
      <link>http://boxcounter.com/reading/2016-06-04-%E9%80%BB%E8%BE%91%E6%80%9D%E7%BB%B4%EF%BC%8C%E5%8F%AA%E8%A6%81%E4%BA%94%E6%AD%A5/</link>
      <pubDate>Sat, 04 Jun 2016 00:00:00 +0000</pubDate>
      
      <guid>http://boxcounter.com/reading/2016-06-04-%E9%80%BB%E8%BE%91%E6%80%9D%E7%BB%B4%EF%BC%8C%E5%8F%AA%E8%A6%81%E4%BA%94%E6%AD%A5/</guid>
      <description>&lt;p&gt;这本书于我而言，乏善可陈。原本30页能说清楚的方法论，絮絮叨叨成了230页的册子。
勉强凑出这么一篇读书笔记。&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://boxcounter.com/images/2016-06-04/逻辑思维，只要五步.png&#34;/&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;源文件：&lt;a href=&#34;https://github.com/boxcounter/boxcounter.github.io/raw/master/attachments/2016-06-04/%e9%80%bb%e8%be%91%e6%80%9d%e7%bb%b4%ef%bc%8c%e5%8f%aa%e8%a6%81%e4%ba%94%e6%ad%a5.mindnode.zip&#34;&gt;逻辑思维，只要五步.mindnode&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>《经济学原理：微观经济学》读书笔记</title>
      <link>http://boxcounter.com/reading/2016-04-16-%E7%BB%8F%E6%B5%8E%E5%AD%A6%E5%8E%9F%E7%90%86%EF%BC%9A%E5%BE%AE%E8%A7%82%E7%BB%8F%E6%B5%8E%E5%AD%A6/</link>
      <pubDate>Sat, 16 Apr 2016 00:00:00 +0000</pubDate>
      
      <guid>http://boxcounter.com/reading/2016-04-16-%E7%BB%8F%E6%B5%8E%E5%AD%A6%E5%8E%9F%E7%90%86%EF%BC%9A%E5%BE%AE%E8%A7%82%E7%BB%8F%E6%B5%8E%E5%AD%A6/</guid>
      <description>&lt;p&gt;下图是缩略版本，文末有清晰源图的链接。&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://boxcounter.com/images/2016-04-16/经济学原理：微观经济学.png&#34;/&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;源文件：&lt;a href=&#34;https://github.com/boxcounter/boxcounter.github.io/raw/master/attachments/2016-04-16/%e7%bb%8f%e6%b5%8e%e5%ad%a6%e5%8e%9f%e7%90%86%ef%bc%9a%e5%be%ae%e8%a7%82%e7%bb%8f%e6%b5%8e%e5%ad%a6.mindnode.zip&#34;&gt;经济学原理：微观经济学.mindnode&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;源图：&lt;a href=&#34;https://github.com/boxcounter/boxcounter.github.io/raw/master/attachments/2016-04-16/%e7%bb%8f%e6%b5%8e%e5%ad%a6%e5%8e%9f%e7%90%86%ef%bc%9a%e5%be%ae%e8%a7%82%e7%bb%8f%e6%b5%8e%e5%ad%a6.png.zip&#34;&gt;经济学原理：微观经济学.png&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>《一本书读懂中国税》读书笔记</title>
      <link>http://boxcounter.com/reading/2016-02-23-%E4%B8%80%E6%9C%AC%E4%B9%A6%E8%AF%BB%E6%87%82%E4%B8%AD%E5%9B%BD%E7%A8%8E/</link>
      <pubDate>Tue, 23 Feb 2016 00:00:00 +0000</pubDate>
      
      <guid>http://boxcounter.com/reading/2016-02-23-%E4%B8%80%E6%9C%AC%E4%B9%A6%E8%AF%BB%E6%87%82%E4%B8%AD%E5%9B%BD%E7%A8%8E/</guid>
      <description>&lt;p&gt;&lt;img src=&#34;http://boxcounter.com/images/2016-02-23/一本书读懂中国税.png&#34;/&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;源文件：&lt;a href=&#34;https://github.com/boxcounter/boxcounter.github.io/raw/master/attachments/2016-02-23/%e4%b8%80%e6%9c%ac%e4%b9%a6%e8%af%bb%e6%87%82%e4%b8%ad%e5%9b%bd%e7%a8%8e.mindnode.zip&#34;&gt;一本书读懂中国税.mindnode&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>《真实世界的经济学》读书笔记</title>
      <link>http://boxcounter.com/reading/2015-09-09-%E7%9C%9F%E5%AE%9E%E4%B8%96%E7%95%8C%E7%9A%84%E7%BB%8F%E6%B5%8E%E5%AD%A6/</link>
      <pubDate>Wed, 09 Sep 2015 00:00:00 +0000</pubDate>
      
      <guid>http://boxcounter.com/reading/2015-09-09-%E7%9C%9F%E5%AE%9E%E4%B8%96%E7%95%8C%E7%9A%84%E7%BB%8F%E6%B5%8E%E5%AD%A6/</guid>
      <description>&lt;p&gt;&lt;img src=&#34;http://boxcounter.com/images/2015-09-09/真实世界的经济学.png&#34;/&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;源文件：&lt;a href=&#34;https://github.com/boxcounter/boxcounter.github.io/raw/master/attachments/2015-09-09/%E7%9C%9F%E5%AE%9E%E4%B8%96%E7%95%8C%E7%9A%84%E7%BB%8F%E6%B5%8E%E5%AD%A6.mindnode.zip&#34;&gt;真实世界的经济学.mindnode&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>RefBase::weakref_type::attemptIncStrong的理解</title>
      <link>http://boxcounter.com/technique/2015-09-05-weakref_type/</link>
      <pubDate>Sat, 05 Sep 2015 00:00:00 +0000</pubDate>
      
      <guid>http://boxcounter.com/technique/2015-09-05-weakref_type/</guid>
      <description>&lt;p&gt;见中文注释内容：&lt;/p&gt;

&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #2b91af&#34;&gt;bool&lt;/span&gt; RefBase::weakref_type::attemptIncStrong(&lt;span style=&#34;color: #0000ff&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color: #2b91af&#34;&gt;void&lt;/span&gt;* id)
{
    incWeak(id);
    
    weakref_impl* &lt;span style=&#34;color: #0000ff&#34;&gt;const&lt;/span&gt; impl = &lt;span style=&#34;color: #0000ff&#34;&gt;static_cast&lt;/span&gt;&amp;lt;weakref_impl*&amp;gt;(&lt;span style=&#34;color: #0000ff&#34;&gt;this&lt;/span&gt;);
    
    &lt;span style=&#34;color: #2b91af&#34;&gt;int32_t&lt;/span&gt; curCount = impl-&amp;gt;mStrong;
    LOG_ASSERT(curCount &amp;gt;= 0, &lt;span style=&#34;color: #a31515&#34;&gt;&amp;quot;attemptIncStrong called on %p after underflow&amp;quot;&lt;/span&gt;,
               &lt;span style=&#34;color: #0000ff&#34;&gt;this&lt;/span&gt;);
    &lt;span style=&#34;color: #0000ff&#34;&gt;while&lt;/span&gt; (curCount &amp;gt; 0 &amp;amp;&amp;amp; curCount != INITIAL_STRONG_VALUE) {
        &lt;span style=&#34;color: #0000ff&#34;&gt;if&lt;/span&gt; (android_atomic_cmpxchg(curCount, curCount+1, &amp;amp;impl-&amp;gt;mStrong) == 0) {
            &lt;span style=&#34;color: #0000ff&#34;&gt;break&lt;/span&gt;;
        }
        curCount = impl-&amp;gt;mStrong;
    }
    
    &lt;span style=&#34;color: #0000ff&#34;&gt;if&lt;/span&gt; (curCount &amp;lt;= 0 || curCount == INITIAL_STRONG_VALUE) {
        &lt;span style=&#34;color: #2b91af&#34;&gt;bool&lt;/span&gt; allow;
        &lt;span style=&#34;color: #0000ff&#34;&gt;if&lt;/span&gt; (curCount == INITIAL_STRONG_VALUE) {
            &lt;span style=&#34;color: #008000&#34;&gt;// Attempting to acquire first strong reference...  this is allowed&lt;/span&gt;
            &lt;span style=&#34;color: #008000&#34;&gt;// if the object does NOT have a longer lifetime (meaning the&lt;/span&gt;
            &lt;span style=&#34;color: #008000&#34;&gt;// implementation doesn&amp;#39;t need to see this), or if the implementation&lt;/span&gt;
            &lt;span style=&#34;color: #008000&#34;&gt;// allows it to happen.&lt;/span&gt;
            &lt;span style=&#34;color: #008000&#34;&gt;//&lt;/span&gt;
            &lt;span style=&#34;color: #008000&#34;&gt;// ====&amp;gt;&lt;/span&gt;
            &lt;span style=&#34;color: #008000&#34;&gt;// 未曾被强引用过，如果也不受弱引用影响，那肯定还未被销毁。&lt;/span&gt;
            &lt;span style=&#34;color: #008000&#34;&gt;// &amp;lt;====&lt;/span&gt;
            &lt;span style=&#34;color: #008000&#34;&gt;//&lt;/span&gt;
            allow = (impl-&amp;gt;mFlags&amp;amp;OBJECT_LIFETIME_WEAK) != OBJECT_LIFETIME_WEAK
                  || impl-&amp;gt;mBase-&amp;gt;onIncStrongAttempted(FIRST_INC_STRONG, id);
        } &lt;span style=&#34;color: #0000ff&#34;&gt;else&lt;/span&gt; {
            &lt;span style=&#34;color: #008000&#34;&gt;// Attempting to revive the object...  this is allowed&lt;/span&gt;
            &lt;span style=&#34;color: #008000&#34;&gt;// if the object DOES have a longer lifetime (so we can safely&lt;/span&gt;
            &lt;span style=&#34;color: #008000&#34;&gt;// call the object with only a weak ref) and the implementation&lt;/span&gt;
            &lt;span style=&#34;color: #008000&#34;&gt;// allows it to happen.&lt;/span&gt;
            &lt;span style=&#34;color: #008000&#34;&gt;//&lt;/span&gt;
            &lt;span style=&#34;color: #008000&#34;&gt;// ====&amp;gt;&lt;/span&gt;
            &lt;span style=&#34;color: #008000&#34;&gt;// 曾经被强引用过，如果不受弱引用影响，那么在RefBase.decStrong()中已经被销毁了，无法revive。&lt;/span&gt;
            &lt;span style=&#34;color: #008000&#34;&gt;// 所以，一定要受弱引用影响。&lt;/span&gt;
            &lt;span style=&#34;color: #008000&#34;&gt;// &amp;lt;====&lt;/span&gt;
            &lt;span style=&#34;color: #008000&#34;&gt;//&lt;/span&gt;
            allow = (impl-&amp;gt;mFlags&amp;amp;OBJECT_LIFETIME_WEAK) == OBJECT_LIFETIME_WEAK
                  &amp;amp;&amp;amp; impl-&amp;gt;mBase-&amp;gt;onIncStrongAttempted(FIRST_INC_STRONG, id);
        }
        &lt;span style=&#34;color: #0000ff&#34;&gt;if&lt;/span&gt; (!allow) {
            decWeak(id);
            &lt;span style=&#34;color: #0000ff&#34;&gt;return&lt;/span&gt; false;
        }
        curCount = android_atomic_inc(&amp;amp;impl-&amp;gt;mStrong);
        &lt;span style=&#34;color: #008000&#34;&gt;// If the strong reference count has already been incremented by&lt;/span&gt;
        &lt;span style=&#34;color: #008000&#34;&gt;// someone else, the implementor of onIncStrongAttempted() is holding&lt;/span&gt;
        &lt;span style=&#34;color: #008000&#34;&gt;// an unneeded reference.  So call onLastStrongRef() here to remove it.&lt;/span&gt;
        &lt;span style=&#34;color: #008000&#34;&gt;// (No, this is not pretty.)  Note that we MUST NOT do this if we&lt;/span&gt;
        &lt;span style=&#34;color: #008000&#34;&gt;// are in fact acquiring the first reference.&lt;/span&gt;
        &lt;span style=&#34;color: #0000ff&#34;&gt;if&lt;/span&gt; (curCount &amp;gt; 0 &amp;amp;&amp;amp; curCount &amp;lt; INITIAL_STRONG_VALUE) {
            impl-&amp;gt;mBase-&amp;gt;onLastStrongRef(id);
        }
    }
    
    impl-&amp;gt;addWeakRef(id);
    impl-&amp;gt;addStrongRef(id);
&lt;span style=&#34;color: #0000ff&#34;&gt;#if PRINT_REFS&lt;/span&gt;
    LOGD(&lt;span style=&#34;color: #a31515&#34;&gt;&amp;quot;attemptIncStrong of %p from %p: cnt=%d\n&amp;quot;&lt;/span&gt;, &lt;span style=&#34;color: #0000ff&#34;&gt;this&lt;/span&gt;, id, curCount);
&lt;span style=&#34;color: #0000ff&#34;&gt;#endif&lt;/span&gt;
    &lt;span style=&#34;color: #0000ff&#34;&gt;if&lt;/span&gt; (curCount == INITIAL_STRONG_VALUE) {
        android_atomic_add(-INITIAL_STRONG_VALUE, &amp;amp;impl-&amp;gt;mStrong);
        impl-&amp;gt;mBase-&amp;gt;onFirstRef();
    }
    
    &lt;span style=&#34;color: #0000ff&#34;&gt;return&lt;/span&gt; true;
}
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #2b91af&#34;&gt;void&lt;/span&gt; RefBase::decStrong(&lt;span style=&#34;color: #0000ff&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color: #2b91af&#34;&gt;void&lt;/span&gt;* id) &lt;span style=&#34;color: #0000ff&#34;&gt;const&lt;/span&gt;
{
    weakref_impl* &lt;span style=&#34;color: #0000ff&#34;&gt;const&lt;/span&gt; refs = mRefs;
    refs-&amp;gt;removeStrongRef(id);
    &lt;span style=&#34;color: #0000ff&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color: #2b91af&#34;&gt;int32_t&lt;/span&gt; c = android_atomic_dec(&amp;amp;refs-&amp;gt;mStrong);
&lt;span style=&#34;color: #0000ff&#34;&gt;#if PRINT_REFS&lt;/span&gt;
    LOGD(&lt;span style=&#34;color: #a31515&#34;&gt;&amp;quot;decStrong of %p from %p: cnt=%d\n&amp;quot;&lt;/span&gt;, &lt;span style=&#34;color: #0000ff&#34;&gt;this&lt;/span&gt;, id, c);
&lt;span style=&#34;color: #0000ff&#34;&gt;#endif&lt;/span&gt;
    LOG_ASSERT(c &amp;gt;= 1, &lt;span style=&#34;color: #a31515&#34;&gt;&amp;quot;decStrong() called on %p too many times&amp;quot;&lt;/span&gt;, refs);
    &lt;span style=&#34;color: #0000ff&#34;&gt;if&lt;/span&gt; (c == 1) {
        &lt;span style=&#34;color: #0000ff&#34;&gt;const_cast&lt;/span&gt;&amp;lt;RefBase*&amp;gt;(&lt;span style=&#34;color: #0000ff&#34;&gt;this&lt;/span&gt;)-&amp;gt;onLastStrongRef(id);
        &lt;span style=&#34;color: #0000ff&#34;&gt;if&lt;/span&gt; ((refs-&amp;gt;mFlags&amp;amp;OBJECT_LIFETIME_WEAK) != OBJECT_LIFETIME_WEAK) {
            &lt;span style=&#34;color: #0000ff&#34;&gt;if&lt;/span&gt; (refs-&amp;gt;mDestroyer) {
                refs-&amp;gt;mDestroyer-&amp;gt;destroy(&lt;span style=&#34;color: #0000ff&#34;&gt;this&lt;/span&gt;);
            } &lt;span style=&#34;color: #0000ff&#34;&gt;else&lt;/span&gt; {
                &lt;span style=&#34;color: #0000ff&#34;&gt;delete&lt;/span&gt; &lt;span style=&#34;color: #0000ff&#34;&gt;this&lt;/span&gt;;
            }
        }
    }
    refs-&amp;gt;removeWeakRef(id);
    refs-&amp;gt;decWeak(id);
}
&lt;/pre&gt;&lt;/div&gt;
&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;完整代码：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://android.googlesource.com/platform/frameworks/base/+/gingerbread/include/utils/RefBase.h&#34;&gt;RefBase.h&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://android.googlesource.com/platform/frameworks/base/+/gingerbread/libs/utils/RefBase.cpp&#34;&gt;RefBase.cpp&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>baselineAligned属性</title>
      <link>http://boxcounter.com/technique/2015-09-01-baselineAligned/</link>
      <pubDate>Tue, 01 Sep 2015 00:00:00 +0000</pubDate>
      
      <guid>http://boxcounter.com/technique/2015-09-01-baselineAligned/</guid>
      <description>&lt;p&gt;在使用LinearLayout+TextView的过程中遇到一个看似诡异的问题，显示效果如下：&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://boxcounter.com/images/2015-09-01/baselineAligned.png&#34; width=&#34;300&#34;/&gt;&lt;/p&gt;

&lt;p&gt;其中两个灰色方块是使用代码动态创建的TextView。它们的父LinearLayout是这样的：&lt;/p&gt;

&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&amp;lt;LinearLayout
    android:id=&lt;span style=&#34;color: #a31515&#34;&gt;&amp;quot;@+id/ll_files&amp;quot;&lt;/span&gt;
    android:layout_width=&lt;span style=&#34;color: #a31515&#34;&gt;&amp;quot;wrap_content&amp;quot;&lt;/span&gt;
    android:layout_height=&lt;span style=&#34;color: #a31515&#34;&gt;&amp;quot;100dp&amp;quot;&lt;/span&gt;
    android:layout_marginTop=&lt;span style=&#34;color: #a31515&#34;&gt;&amp;quot;7.5dp&amp;quot;&lt;/span&gt;
    android:orientation=&lt;span style=&#34;color: #a31515&#34;&gt;&amp;quot;horizontal&amp;quot;&lt;/span&gt;
    /&amp;gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;不知道是什么原因，导致第一个TextView「下挫」了一些。仔细检查了它的margin和padding都是0、符合预期，但top是29。&lt;/p&gt;

&lt;p&gt;仔细阅读了一遍代码和布局文件，确定我并没有误调整top，那么问题应该出现在动态layout过程中。那就开始调试分析吧。&lt;/p&gt;

&lt;p&gt;顺着LinearLayout.onLayout()追踪到了LinearLayout.layoutHorizontal()，发现了这样一段代码：&lt;/p&gt;

&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #2b91af&#34;&gt;void&lt;/span&gt; layoutHorizontal(&lt;span style=&#34;color: #2b91af&#34;&gt;int&lt;/span&gt; left, &lt;span style=&#34;color: #2b91af&#34;&gt;int&lt;/span&gt; top, &lt;span style=&#34;color: #2b91af&#34;&gt;int&lt;/span&gt; right, &lt;span style=&#34;color: #2b91af&#34;&gt;int&lt;/span&gt; bottom) {
    &lt;span style=&#34;color: #008000&#34;&gt;// 若干无关代码，略&lt;/span&gt;
    
    &lt;span style=&#34;color: #2b91af&#34;&gt;int&lt;/span&gt; childBaseline = -1;
    
    &lt;span style=&#34;color: #0000ff&#34;&gt;final&lt;/span&gt; LinearLayout.LayoutParams lp =
            (LinearLayout.LayoutParams) child.getLayoutParams();
    
    &lt;span style=&#34;color: #0000ff&#34;&gt;if&lt;/span&gt; (baselineAligned &amp;amp;&amp;amp; lp.height != LayoutParams.MATCH_PARENT) {
        childBaseline = child.getBaseline();
    }
    
    &lt;span style=&#34;color: #008000&#34;&gt;// 若干无关代码，略&lt;/span&gt;
    
    &lt;span style=&#34;color: #0000ff&#34;&gt;switch&lt;/span&gt; (gravity &amp;amp; Gravity.VERTICAL_GRAVITY_MASK) {
        &lt;span style=&#34;color: #0000ff&#34;&gt;case&lt;/span&gt; Gravity.TOP:
            childTop = paddingTop + lp.topMargin;
            &lt;span style=&#34;color: #0000ff&#34;&gt;if&lt;/span&gt; (childBaseline != -1) {
                childTop += maxAscent[INDEX_TOP] - childBaseline;  &lt;span style=&#34;color: #008000&#34;&gt;// &amp;lt;==== A&lt;/span&gt;
            }
            &lt;span style=&#34;color: #0000ff&#34;&gt;break&lt;/span&gt;;
    
    &lt;span style=&#34;color: #008000&#34;&gt;// 若干无关代码，略&lt;/span&gt;
}
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;当执行完A行时，childTop等于29。问题出在这里，再反向阅读代码，跟踪到了两个关键变量：&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;baselineAligned为true；&lt;/li&gt;
&lt;li&gt;childBaseline不为0；&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;这时我想起文本的&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E5%9F%BA%E7%B7%9A&#34;&gt;baseline属性&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;继续查阅文档、代码，得到两个结论：&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;LinearLayout的baselineAligned默认为true；&lt;/li&gt;
&lt;li&gt;TextView重写了getBaseline()，返回了有效值；&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;定位了问题症结，解决方案也就不难找了：将LinearLayout的android:baselineAligned改为false。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ImageView.ScaleType</title>
      <link>http://boxcounter.com/technique/2015-08-13-ImageView-ScaleType/</link>
      <pubDate>Thu, 13 Aug 2015 00:00:00 +0000</pubDate>
      
      <guid>http://boxcounter.com/technique/2015-08-13-ImageView-ScaleType/</guid>
      <description>&lt;p&gt;开启了「Show layout bounds」。左侧是宽图、右侧是竖图：&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://boxcounter.com/images/2015-08-13/scaleTypeHorizontal.png&#34;  width=&#34;500&#34;/&gt;
&lt;img src=&#34;http://boxcounter.com/images/2015-08-13/scaleTypeVertical.png&#34;  width=&#34;500&#34;/&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>《从来就没有救世主》读书笔记</title>
      <link>http://boxcounter.com/reading/2015-08-08-%E4%BB%8E%E6%9D%A5%E5%B0%B1%E6%B2%A1%E6%9C%89%E6%95%91%E4%B8%96%E4%B8%BB/</link>
      <pubDate>Sat, 08 Aug 2015 00:00:00 +0000</pubDate>
      
      <guid>http://boxcounter.com/reading/2015-08-08-%E4%BB%8E%E6%9D%A5%E5%B0%B1%E6%B2%A1%E6%9C%89%E6%95%91%E4%B8%96%E4%B8%BB/</guid>
      <description>&lt;p&gt;&lt;img src=&#34;http://boxcounter.com/images/2015-08-08/从来就没有救世主.png&#34;/&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;源文件：&lt;a href=&#34;https://github.com/boxcounter/boxcounter.github.io/raw/master/attachments/2015-08-08/%E4%BB%8E%E6%9D%A5%E5%B0%B1%E6%B2%A1%E6%9C%89%E6%95%91%E4%B8%96%E4%B8%BB.mindnode.zip&#34;&gt;从来就没有救世主.mindnode&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Android下列表视图的性能优化</title>
      <link>http://boxcounter.com/technique/2015-08-01-Android%E4%B8%8B%E5%88%97%E8%A1%A8%E8%A7%86%E5%9B%BE%E7%9A%84%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/</link>
      <pubDate>Sat, 01 Aug 2015 00:00:00 +0000</pubDate>
      
      <guid>http://boxcounter.com/technique/2015-08-01-Android%E4%B8%8B%E5%88%97%E8%A1%A8%E8%A7%86%E5%9B%BE%E7%9A%84%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/</guid>
      <description>

&lt;h1 id=&#34;前言&#34;&gt;前言&lt;/h1&gt;

&lt;p&gt;Android下使用列表控件，如&lt;code&gt;RecyclerView&lt;/code&gt;和&lt;code&gt;ListView&lt;/code&gt;，很容易遇到滚动不流畅的问题。本文记录我的一次性能优化过程。&lt;/p&gt;

&lt;h1 id=&#34;常见范式&#34;&gt;常见范式&lt;/h1&gt;

&lt;p&gt;我们经常这样使用列表控件：&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;（使用&lt;code&gt;ListView&lt;/code&gt;）重写&lt;code&gt;Adapter.getView()&lt;/code&gt;，在其中创建或重用View和ViewHolder，将业务数据结构显示到View中。&lt;/li&gt;
&lt;li&gt;（使用&lt;code&gt;RecylerView&lt;/code&gt;）重写&lt;code&gt;Adapter.onCreateViewHolder()&lt;/code&gt;和&lt;code&gt;Adapter.onBindViewHolder()&lt;/code&gt;，在前者中创建View和ViewHolder，在后者中将业务数据结构显示到View中。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;这个范式用了一种优化技术：View重用。避免了频繁的create view和find view过程，这两个过程都是很耗时的。但仅这一种优化手段不足以解决所有的性能问题。&lt;/p&gt;

&lt;h1 id=&#34;优化过程&#34;&gt;优化过程&lt;/h1&gt;

&lt;p&gt;接下来，我将基于一个实际项目的简化版来说明如何进行优化。&lt;/p&gt;

&lt;h2 id=&#34;一-减少overdraw&#34;&gt;一、减少Overdraw&lt;/h2&gt;

&lt;p&gt;Overdraw是常见性能损耗点，且多是无谓的性能损耗。相关资料非常丰富，这里不赘述。只提醒一点：善用&lt;code&gt;Window.setBackgroundDrawable*()&lt;/code&gt;。&lt;/p&gt;

&lt;h2 id=&#34;二-内存优化&#34;&gt;二、内存优化&lt;/h2&gt;

&lt;p&gt;优化内存使用也是一种常用的性能优化手段。它的机理是：GC会暂停所有线程，而频繁触发GC会加剧掉帧问题。&lt;/p&gt;

&lt;p&gt;来看一下主题的设计图，其中图片矩阵可以容纳0~9张图片。&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://boxcounter.com/images/2015-08-01/memorySample.png&#34; width=&#34;300&#34;/&gt;&lt;/p&gt;

&lt;p&gt;优化方法是：尽量缓存、重用ImageView。比如：在&lt;code&gt;onBindViewHolder()&lt;/code&gt;中发现图片矩阵控件中已经包含了7个ImageView（上次该控件显示的主题有7张图片），当前要显示的主题有5张图片，那么直接重用前5个ImageView，隐藏剩下的2个ImageView。&lt;/p&gt;

&lt;h2 id=&#34;三-精简布局&#34;&gt;三、精简布局&lt;/h2&gt;

&lt;p&gt;来看一下主题的赞和评论区域。其中赞区域会有两种展现形式（针对不同的应用场景）。想想如果是你来实现，会怎么布局。&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://boxcounter.com/images/2015-08-01/hierachySample1.png&#34; width=&#34;300&#34;/&gt;
&lt;img src=&#34;http://boxcounter.com/images/2015-08-01/hierachySample2.png&#34; width=&#34;300&#34;/&gt;&lt;/p&gt;

&lt;p&gt;布局方式可能会是这样：&lt;/p&gt;

&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&amp;lt;LinearLayout android:orientation=&lt;span style=&#34;color: #a31515&#34;&gt;&amp;quot;vertical&amp;quot;&lt;/span&gt; &amp;gt;

    &lt;span style=&#34;color: #008000&#34;&gt;&amp;lt;!-- 赞区域 --&amp;gt;&lt;/span&gt;
    &amp;lt;LinearLayout android:orientation=&lt;span style=&#34;color: #a31515&#34;&gt;&amp;quot;horizontal&amp;quot;&lt;/span&gt; &amp;gt;
        &amp;lt;ImageView /&amp;gt;   &lt;span style=&#34;color: #008000&#34;&gt;&amp;lt;!-- 心形图标 --&amp;gt;&lt;/span&gt;
        &amp;lt;GridLayout /&amp;gt;  &lt;span style=&#34;color: #008000&#34;&gt;&amp;lt;!-- 头像形式的赞 --&amp;gt;&lt;/span&gt;
        &amp;lt;TextView /&amp;gt;    &lt;span style=&#34;color: #008000&#34;&gt;&amp;lt;!-- 文字形式的赞 --&amp;gt;&lt;/span&gt;
    &amp;lt;/LinearLayout&amp;gt;

    &lt;span style=&#34;color: #008000&#34;&gt;&amp;lt;!-- 评论区域 --&amp;gt;&lt;/span&gt;
    &amp;lt;LinearLayout android:orientation=&lt;span style=&#34;color: #a31515&#34;&gt;&amp;quot;horizontal&amp;quot;&lt;/span&gt; &amp;gt;
        &amp;lt;ImageView /&amp;gt;   &lt;span style=&#34;color: #008000&#34;&gt;&amp;lt;!-- 评论图标 --&amp;gt;&lt;/span&gt;
        &amp;lt;LinearLayout
            android:orientation=&lt;span style=&#34;color: #a31515&#34;&gt;&amp;quot;vertical&amp;quot;&lt;/span&gt;
            /&amp;gt; &lt;span style=&#34;color: #008000&#34;&gt;&amp;lt;!-- 评论列表容器 --&amp;gt;&lt;/span&gt;
    &amp;lt;/LinearLayout&amp;gt;

&amp;lt;/LinearLayout&amp;gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;根据赞的显示方式来设置&lt;code&gt;GridLayout&lt;/code&gt;和&lt;code&gt;TextView&lt;/code&gt;的Visibility。&lt;/p&gt;

&lt;p&gt;我的方法是：根据需要动态改变布局结构、保正显示效果的同时精简数量和层级。优化后是这样：&lt;/p&gt;

&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&amp;lt;LinearLayout android:orientation=&lt;span style=&#34;color: #a31515&#34;&gt;&amp;quot;vertical&amp;quot;&lt;/span&gt; &amp;gt;

    &lt;span style=&#34;color: #008000&#34;&gt;&amp;lt;!-- 赞区域 --&amp;gt;&lt;/span&gt;
    &amp;lt;ViewStub android:background=&lt;span style=&#34;color: #a31515&#34;&gt;&amp;quot;heart.9.png&amp;quot;&lt;/span&gt; /&amp;gt;

    &lt;span style=&#34;color: #008000&#34;&gt;&amp;lt;!-- 评论区域 --&amp;gt;&lt;/span&gt;
    &amp;lt;LinearLayout
        android:orientation=&lt;span style=&#34;color: #a31515&#34;&gt;&amp;quot;vertical&amp;quot;&lt;/span&gt;
        android:background=&lt;span style=&#34;color: #a31515&#34;&gt;&amp;quot;comment.9.png&amp;quot;&lt;/span&gt;
        android:paddingStart=&lt;span style=&#34;color: #a31515&#34;&gt;&amp;quot;?dp&amp;quot;&lt;/span&gt;
        /&amp;gt; &lt;span style=&#34;color: #008000&#34;&gt;&amp;lt;!-- 评论列表容器 --&amp;gt;&lt;/span&gt;

&amp;lt;/LinearLayout&amp;gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;首先，原赞区域的&lt;code&gt;GridLayout&lt;/code&gt;和&lt;code&gt;TextView&lt;/code&gt;都放到单独的布局文件中，原布局中换上&lt;code&gt;ViewStub&lt;/code&gt;，根据需要动态inflate。其次，赞和评论图标改成.9图作为&lt;code&gt;Background&lt;/code&gt;、并辅以&lt;code&gt;paddingStart&lt;/code&gt;（具体数值由评论图标的宽度计算得到）。&lt;/p&gt;

&lt;p&gt;后者的缺点是.9图可能因为拉伸变得不够清晰，但实测下来效果满足需要。&lt;/p&gt;

&lt;h2 id=&#34;四-改进布局&#34;&gt;四、改进布局&lt;/h2&gt;

&lt;p&gt;常用的方法有：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;在不增加布局层次及复杂度的前提下，用LinearLayout替换RelativeLayout；&lt;/li&gt;
&lt;li&gt;减少LinearLayout.layout_weight属性的使用，分享一下项目中一个LinearLayout的实际数据：

&lt;ul&gt;
&lt;li&gt;使用layout_weight，measure耗时5.86ms；&lt;/li&gt;
&lt;li&gt;弃用layout_weight，measure耗时2.28ms；&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;五-预处理&#34;&gt;五、预处理&lt;/h2&gt;

&lt;p&gt;需要引入一点业务数据结构来辅助说明。&lt;/p&gt;

&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #008000&#34;&gt;// 约定：为了行文简洁，本文中所有代码都隐藏了诸如public关键字、构造函数等非核心内容。&lt;/span&gt;

&lt;span style=&#34;color: #008000&#34;&gt;// 主题&lt;/span&gt;
&lt;span style=&#34;color: #0000ff&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color: #2b91af&#34;&gt;Topic&lt;/span&gt; {
    String mText;               &lt;span style=&#34;color: #008000&#34;&gt;// 文字内容。&lt;/span&gt;
    List&amp;lt;String&amp;gt; mImages;       &lt;span style=&#34;color: #008000&#34;&gt;// 图片链接。&lt;/span&gt;
    List&amp;lt;User&amp;gt; mLikes;          &lt;span style=&#34;color: #008000&#34;&gt;// 点赞的用户。&lt;/span&gt;
    List&amp;lt;Comment&amp;gt; mComments;    &lt;span style=&#34;color: #008000&#34;&gt;// 评论。&lt;/span&gt;
    User mCreater;              &lt;span style=&#34;color: #008000&#34;&gt;// 发表人。&lt;/span&gt;
    &lt;span style=&#34;color: #2b91af&#34;&gt;long&lt;/span&gt; mCreateTime;           &lt;span style=&#34;color: #008000&#34;&gt;// 发表的时间戳。&lt;/span&gt;
}

&lt;span style=&#34;color: #008000&#34;&gt;// 评论&lt;/span&gt;
&lt;span style=&#34;color: #0000ff&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color: #2b91af&#34;&gt;Comment&lt;/span&gt; {
    String mText;   &lt;span style=&#34;color: #008000&#34;&gt;// 文字内容。&lt;/span&gt;
    User mCreater;  &lt;span style=&#34;color: #008000&#34;&gt;// 发表人。&lt;/span&gt;
}

&lt;span style=&#34;color: #008000&#34;&gt;// 用户&lt;/span&gt;
&lt;span style=&#34;color: #0000ff&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color: #2b91af&#34;&gt;User&lt;/span&gt; {
    String mName;       &lt;span style=&#34;color: #008000&#34;&gt;// 用户名称。&lt;/span&gt;
    String mAvatarUrl;  &lt;span style=&#34;color: #008000&#34;&gt;// 头像的下载地址。&lt;/span&gt;
}
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这其中有部分数据是可以预处理的，得到的数据结构如下：&lt;/p&gt;

&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #0000ff&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color: #2b91af&#34;&gt;PreprocessResult&lt;/span&gt; {
    CharSequence mText;             &lt;span style=&#34;color: #008000&#34;&gt;// 包含Spannable（比如超链接）的正文。&lt;/span&gt;
    String mLikes;                  &lt;span style=&#34;color: #008000&#34;&gt;// 用逗号分隔的文字形式的点赞用户的名称。&lt;/span&gt;
    List&amp;lt;CharSequence&amp;gt; mComments;   &lt;span style=&#34;color: #008000&#34;&gt;// 包含Spannable的评论列表。&lt;/span&gt;
    String mCreateTime;             &lt;span style=&#34;color: #008000&#34;&gt;// 发表时间。&lt;/span&gt;
}
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然后在&lt;code&gt;onBindViewHolder()&lt;/code&gt;中就可以直接将&lt;code&gt;PreprocessResult&lt;/code&gt;的内容设置到相应的view上，避免在UI线程中动态处理造成掉帧。&lt;/p&gt;

&lt;p&gt;这种方法的缺点是增加了复杂度：PreprocessResult需要和Topic保持同步更新。比如用户点赞、发表评论之后，需要同步修改PreprocessResult和Topic。&lt;/p&gt;

&lt;h2 id=&#34;六-预创建&#34;&gt;六、预创建&lt;/h2&gt;

&lt;p&gt;分析发现，滚动过程会因为动态创建TopicView而卡顿。TopicView是用来显示整个主题的自定义View，包含前述的赞和评论等子布局。即便经过精简，整个布局依然比较复杂，inflate过程很耗时。于是预先创建了一些TopicView备用，在&lt;code&gt;onCreateViewHolder()&lt;/code&gt;中尽量使用它们，如果备用已经用完再动态创建。&lt;/p&gt;

&lt;h2 id=&#34;七-优化textview&#34;&gt;七、优化TextView&lt;/h2&gt;

&lt;p&gt;经过上述这几步优化之后，流畅度提升了很多，但偶尔还是会出现较明显的卡顿现象。分析发现是&lt;code&gt;TextView.setText()&lt;/code&gt;耗时过长导致的，在高强度测试下（长文主题，并且有很多评论），平均一次长文的调用就可能耗时22ms，已经超过了保证帧率的16ms上限。&lt;/p&gt;

&lt;p&gt;因为这个项目的业务逻辑决定了主题、评论的文字内容不会被修改，只有增删。于是采用的优化方法是：对于主题正文和评论，用&lt;code&gt;StaticLayout&lt;/code&gt;配合自定义View展示文字。自定义View代码如下：&lt;/p&gt;

&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #0000ff&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color: #0000ff&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color: #2b91af&#34;&gt;StaticLayoutView&lt;/span&gt; &lt;span style=&#34;color: #0000ff&#34;&gt;extends&lt;/span&gt; View {
    &lt;span style=&#34;color: #0000ff&#34;&gt;private&lt;/span&gt; StaticLayout mLayout;

    &lt;span style=&#34;color: #0000ff&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color: #2b91af&#34;&gt;void&lt;/span&gt; setLayout(StaticLayout layout) {
        mLayout = layout;

        &lt;span style=&#34;color: #2b91af&#34;&gt;int&lt;/span&gt; height = layout.getHeight();
        &lt;span style=&#34;color: #0000ff&#34;&gt;if&lt;/span&gt; ((mLayout.getWidth() != layout.getWidth()) ||
                (mLayoutHeight != height)) {
            requestLayout();
        }

        mLayoutHeight = height;
    }

    @Override
    &lt;span style=&#34;color: #0000ff&#34;&gt;protected&lt;/span&gt; &lt;span style=&#34;color: #2b91af&#34;&gt;void&lt;/span&gt; onDraw(Canvas canvas) {
        &lt;span style=&#34;color: #0000ff&#34;&gt;super&lt;/span&gt;.onDraw(canvas);

        canvas.save();
        &lt;span style=&#34;color: #0000ff&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color: #0000ff&#34;&gt;null&lt;/span&gt; != mLayout) {
            canvas.translate(getPaddingLeft(), getPaddingTop());
            mLayout.draw(canvas);
        }
        canvas.restore();
    }

    @Override
    &lt;span style=&#34;color: #0000ff&#34;&gt;protected&lt;/span&gt; &lt;span style=&#34;color: #2b91af&#34;&gt;void&lt;/span&gt; onMeasure(&lt;span style=&#34;color: #2b91af&#34;&gt;int&lt;/span&gt; widthMeasureSpec, &lt;span style=&#34;color: #2b91af&#34;&gt;int&lt;/span&gt; heightMeasureSpec) {
        &lt;span style=&#34;color: #0000ff&#34;&gt;super&lt;/span&gt;.onMeasure(widthMeasureSpec, heightMeasureSpec);
        &lt;span style=&#34;color: #0000ff&#34;&gt;if&lt;/span&gt; (&lt;span style=&#34;color: #0000ff&#34;&gt;null&lt;/span&gt; != mLayout) {
            setMeasuredDimension(getMeasuredWidth(),
                    mLayoutHeight + getPaddingTop() + getPaddingBottom());
        }
    }
}
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;StaticLayoutView相比TextView简单、高效很多，更重要的是&lt;code&gt;StaticLayout&lt;/code&gt;可以在非UI线程创建、初始化。于是前述「预处理」过程中的数据结构变为：&lt;/p&gt;

&lt;div class=&#34;highlight&#34; style=&#34;background: #ffffff&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;span style=&#34;color: #0000ff&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color: #2b91af&#34;&gt;PreprocessResult&lt;/span&gt; {
    StaticLayout mText;             &lt;span style=&#34;color: #008000&#34;&gt;// &amp;lt;= 之前是CharSequence&lt;/span&gt;
    String mLikes;
    List&amp;lt;StaticLayout&amp;gt; mComments;   &lt;span style=&#34;color: #008000&#34;&gt;// &amp;lt;= 之前是List&amp;lt;CharSequence&amp;gt;&lt;/span&gt;
    String mCreateTime;
}
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;优化后，在高强度测试环境下，平均帧率从34上升至47。实际环境中的平均帧率约为51。&lt;/p&gt;

&lt;h1 id=&#34;总结&#34;&gt;总结&lt;/h1&gt;

&lt;p&gt;整个优化过程的核心思想是：&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;尽量减少滚动时UI线程中的耗时操作。能挪到后台线程的就不在UI线程中做，必须在UI线程做、但能预先处理的就提早处理；&lt;/li&gt;
&lt;li&gt;以空间换时间。用缓存来减少GC、创建等耗时操作；&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;需要说明的是，一些优化方法是有代价的：&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;预处理可能增加用户的等待时间。以这个项目为例，进入某Activity后，一边显示进度条，一边从服务端获取一批Topic显示给用户。预处理和预先创建会较明显地增加用户的等待时间；&lt;/li&gt;
&lt;li&gt;缓存数据越多，OOM的风险越大；&lt;/li&gt;
&lt;li&gt;增加了复杂度；&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&#34;后记&#34;&gt;后记&lt;/h1&gt;

&lt;p&gt;除前述优化方法之外，还有一些零星的、未能实际应用的优化方法。比如：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;在&lt;code&gt;onBindViewHolder()&lt;/code&gt;中检查之前显示的内容是否就是当前将要显示的内容。如果是，return即可。这种方法可以在反方向滚动时，避免不必要的更新view操作。但前提条件是内容不会动态改变，在这个项目中Topic的内容是可能动态改变的，使用这个方法后反而增加了复杂度，权衡得失后，放弃了这个优化方法；&lt;/li&gt;
&lt;li&gt;使用Tracer for OpenGL检查OpenGL渲染过程；&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;此外，即便经过这一系列的优化，卡顿问题也未能根除。后续我可能会继续改进优化方案，如果有新的心得体会，再补上。也希望有同好分享经验，相互交流，共同进步，谢谢。&lt;/p&gt;

&lt;p&gt;最后，聊一下我对性能优化的一些建议：&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;先分析性能瓶颈，再对症下药。对于有经验的研发，这个过程可以适当地借助自己的经验法则。忌讳想当然的「优化」。&lt;/li&gt;
&lt;li&gt;善用工具。比如Traceview、Memory Monitor、Hierarchy Viewer。本文所述的优化过程重度依赖这些工具。&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&#34;参考资料&#34;&gt;参考资料&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://android-developers.blogspot.com/2010/10/traceview-war-story.html&#34;&gt;Traceview War Story&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://developer.android.com/intl/zh-cn/tools/debugging/debugging-ui.html&#34;&gt;Optimizing Your UI&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/playlist?list=PLWz5rJ2EKKc9CBxr3BVjPTPoDPLdPIFCE&#34;&gt;Android Performance Patterns&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.curious-creature.com/2012/12/01/android-performance-case-study/&#34;&gt;Android Performance Case Study&lt;/a&gt; by Romain Guy&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.curious-creature.com/docs/android-performance-case-study-1.html&#34;&gt;Android Performance Case Study（同名不同文）&lt;/a&gt; by Romain Guy&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://hukai.me/android-performance-patterns/&#34;&gt;Android性能优化典范&lt;/a&gt; by 胡凯&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://ragnraok.github.io/textview-pre-render-research.html&#34;&gt;TextView预渲染研究&lt;/a&gt; by Ragnarok&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://instagram-engineering.tumblr.com/post/114508858967/improving-comment-rendering-on-android&#34;&gt;Improving Comment Rendering on Android&lt;/a&gt; by Instagram&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>机械键盘之「Kinesis Contoured Advantage」</title>
      <link>http://boxcounter.com/essay/2014-01-25-%E6%9C%BA%E6%A2%B0%E9%94%AE%E7%9B%98/</link>
      <pubDate>Sat, 25 Jan 2014 00:00:00 +0000</pubDate>
      
      <guid>http://boxcounter.com/essay/2014-01-25-%E6%9C%BA%E6%A2%B0%E9%94%AE%E7%9B%98/</guid>
      <description>&lt;p&gt;分享一点我的机械键盘体验。目前正在使用「Kinesis Contoured Advantage」。如图：
　　&lt;img src=&#34;http://boxcounter.com/images/2013-01-25/Kinesis-Contoured-Advantage.jpg&#34;/&gt;&lt;/p&gt;

&lt;p&gt;　　2013年的愚人节我在amazon.com上入的这把键盘（感谢BT姐的美帝仓储），用到现在差不多9个月了。顺嘴说一句，试了几次海淘，感觉不一定比淘宝实惠。比如关税、运费、等待时间等等。&lt;br /&gt;
　　入这把键盘的缘由是为了缓解左右小拇指的压力，更根本的缘由是因为我是重度的emacs使用者。从头开始讲吧，顺便也分享一点体会：&lt;br /&gt;
　　我大概是两年前开始使用emacs，之前使用的是vim，再之前是各种编辑器和IDE（估计有上十款）。截至到目前，emacs是我最满意的一款。编辑器很容易惹口水，还是扯回来说我的体验吧。&lt;br /&gt;
　　emacs的快捷键几乎都以ctrl或alt与其它键的组合，特别是ctrl，常用的快捷键一多半都用它。比如：打开文件「ctrl+x ctrl+f」，保存文件「ctrl+x ctrl+s」。所以蛮多emacser都会将ctrl键和caps-lock键对调。这样左小拇指敲ctrl的时候会舒适一些。此外，emacs的「上一行」的快捷键是「ctrl+p」。于是emacser的左右小拇指的压力会比一般人更大一些。&lt;br /&gt;
　　绝大多数人使用的键盘布局都是qwerty，这个键盘布局并不是一个好的设计，而是为了解决一个挺让人无语的问题的产物。有兴趣的朋友可以看看&lt;a href=&#34;http://zh.wikipedia.org/wiki/QWERTY%E9%8D%B5%E7%9B%A4&#34;&gt;维基上qwerty的介绍&lt;/a&gt;。更加剧了手指负荷的不均，比如最有力的大拇指基本只用来敲「space alt」。而小拇指却要负责多上许多的键，比如右小拇指需要负责：「0 p : &amp;ldquo; ? delete enter」等。对码农而言就更惨了，因为要负责更多的高频键，比如「) = { }」等。&lt;br /&gt;
　　我个人感觉会更明显，因为我敲键盘比较用力。我倒不是喜欢把手指抬高然后猛敲下去，而是手指贴着键盘，按下去的时候会很用力，要不总担心没按到位。时间长了，大概1年多之后，在高强度码代码之后小拇指会出现疲劳酸涨的感觉。思索了一些解决方案，包括换键盘映射，比如dvorak。但是反复思量、体验，最终还是放弃了。于是开始留心人体工学键盘，偶然间发现了这款键盘。&lt;/p&gt;

&lt;p&gt;　　这款键盘应该是相当小众的一款，google上搜不到太多的资料，中文的使用体验貌似就一两篇。我入的时候也抱着有赌的想法。来说说这款键盘的特性：&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;为最有力的大拇指准备了很多键。&lt;br /&gt;
而且考虑到了大拇指的尺寸和位置，将最贴合大拇指的四个键做得很大。极大的提升了大拇指的功效和输入的整体舒适性。比如我就把这些键设置到了大拇指区域：左手「ctrl alt」，右手「enter space delete」。&lt;/li&gt;
&lt;li&gt;左右分布和手托设计更合理。&lt;br /&gt;
左右手的工作区域分隔的更开了，配合手托，双手可以自然伸直，不用别手腕。小臂也可以基本平行，摆放更舒服。&lt;/li&gt;
&lt;li&gt;方向键位置更合理。&lt;br /&gt;
方向键都放在食指和中指区，非常方便使用。常规键盘的方向键都是单独放在右下角，需要使用的时候右手需要移出主工作区域。对我个人来说操作起来很别扭，需要低头找方向键，敲完了还要再摸索回主工作区。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;　　上面两点是这款键盘最突出的几个优点。可以算是它区别于其它机械键盘的杀手级优点。有的网评还列举了一些其它的优点，我倒感觉一般般，比如：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;更符合人体工学的「凹陷的键区」。&lt;br /&gt;
目前我还没有明显感觉到它的凹陷设计比其它机械键盘更舒适。&lt;/li&gt;
&lt;li&gt;高度可定制，并且自带记忆效果。&lt;br /&gt;
前者我用的少，只是重设定了几个键之后就再也不改了。宏定义我一次也没用过。记忆效果也没什么感觉，因为这货体积庞大，并不适合随身携带。估计大部分用户都只用来配合一台机器使用吧。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;　　再来说一下它的缺点：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Fx键基本没法用。&lt;br /&gt;
最上面一排的Fx键尺寸太小，而且间隔特均匀。不低头瞄一眼，根本找不着目标键。&lt;/li&gt;
&lt;li&gt;制作工艺一般。&lt;br /&gt;
相对我使用的另一款filco而言。键帽的手感等等要差一些。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;　　总结：&lt;br /&gt;
　　如果是重度的emacser，推荐入一把。如果是键盘操作流，可以考虑入一把。如果是轻度机械键盘爱好者，慎重考虑。&lt;/p&gt;

&lt;p&gt;　　对了，这货有原厂脚踏板可选购。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>一起疑似内存泄漏</title>
      <link>http://boxcounter.com/technique/2014-01-12-suspected-memory-leak/</link>
      <pubDate>Sun, 12 Jan 2014 00:00:00 +0000</pubDate>
      
      <guid>http://boxcounter.com/technique/2014-01-12-suspected-memory-leak/</guid>
      <description>&lt;p&gt;上周遇到一起极其诡异的内存泄漏。现象是：&lt;br /&gt;
某种测试方法可以使程序物理内存使用量（top命令的RES列）持续上升。当停止测试之后，程序内存使用量稳定在测试过程中的最高值不变。从现象上看就是一典型的内存泄漏。&lt;/p&gt;

&lt;p&gt;我的诊断步骤：&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;使用valgrind的memcheck检查泄漏。故障重现后让程序自然退出。memcheck提示资源泄漏量为0.&lt;br /&gt;
所以，该内存应该没有被泄漏，程序中对它们还有引用，在程序退出时被正常释放掉了。&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;使用valgrind的massif分析内存使用。找到了一处可疑的「泄漏」点，90%的内存都是在该处分配。&lt;br /&gt;
但是调试发现该处分配（通过malloc）的内存都被正确的释放（通过free）掉了。&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;使用malloc_info函数查看程序运行过程中的内存情况。
这是在程序物理内存占用2G后我停止测试以后一段时间（大概5分钟）的输出：&lt;/p&gt;

&lt;p&gt;arena(462848), ordblks(2), smblks(1), hblks(5), hblkhd(104857600), usmblks(0), fsmblks(32), uordblks(459424), fordblks(3424), keepcost(3360).&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;从上面看，从heap中申请了462848(arena的值，约46KB)，mmap申请的内存是104857600（hblkhd的值，约100MB）。这俩值加在一起和top里显示的2G差很远啊。
   注，arena和hblkhd的man注解：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt; arena   The total amount of memory allocated by means other than
         mmap(2) (i.e., memory allocated on the heap).  This figure
         includes both in-use blocks and blocks on the free list.
 hblkhd  The number of bytes in blocks currently allocated using
         mmap(2).
&lt;/code&gt;&lt;/pre&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;决定统计内存分配释放的次数和尺寸，目的是检查是否严重失衡。因为new/delete不太好跟踪，所以只处理了malloc/free。&lt;br /&gt;
使用的方法是wrap（gcc/g++的「-Wl,&amp;ndash;wrap,malloc」选项），看了一眼glibc的源码，以在free时候得到待释放内存的尺寸。最后的结果是没有严重失衡，应该不是显式的内存释放。&lt;br /&gt;
其实这个实验原本就没有报很大的希望，一来new/delete没有照顾到，不够精确。二来如果是显式的泄漏memcheck早就报告了。但是当时没有思路了，姑且一试，看能不能找到点面包屑。&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;搜索了一些资料。有些提到glibc内部使用brk和mmap来进行内存分配，其中brk可能会造成这种泄漏假象。&lt;br /&gt;
于是在程序的开始设置了M_MMAP_THRESHOLD，发现故障依然存在。&lt;/p&gt;

&lt;p&gt;mallopt(M_MMAP_THRESHOLD, 1024*1024*1024); // 1G&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;原本还想在不同的模块里使用不同的堆，然后反复根据堆的尺寸细分堆，来精确定位。却发现linux下没有类似HeapCreate的函数。&lt;/p&gt;

&lt;p&gt;技穷了。于是我邀请一位同事来协助分析，在协作中我发现我犯了个错误：尝试方法5的时候，我理解反了M_MMAP_THRESHOLD的含义，于是提供错了参数。实际上应该是这样：&lt;/p&gt;

&lt;p&gt;mallopt(M_MMAP_THRESHOLD, 0);&lt;/p&gt;

&lt;p&gt;然后故障消失了。也就是说，这次的故障实际并不是我们程序实现的资源泄漏，而是glibc堆管理机制导致的「资源泄漏」。我很奇怪为什么glibc没有重用程序调用free释放掉的空间，而是继续扩充堆。这个问题值得继续琢磨。&lt;/p&gt;

&lt;p&gt;总结：本次故障的分析过程里我的粗心大意又给自己惹了大麻烦。原本思路是正确的，结果走歪了。。。 自作孽啊。。。&lt;/p&gt;

&lt;p&gt;但是，即便这个故障不是程序实现BUG所导致的，实际上还是会对程序造成不好的影响：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;如果调整M_MMAP_THRESHOLD让程序不「泄漏」，那么资源占用和性能会变差。原因参考帮助文档中对该参数的描述。&lt;/li&gt;
&lt;li&gt;如果放任不管，程序会不停地吃内存，并且占住不释放。我尝试让程序持续吃内存，最后稳定在3GB的物理内存（共4G）和2.6G的swap空间（共4G）的消耗。（但没有被oom killer干掉）&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;再琢磨琢磨吧。&lt;/p&gt;

&lt;p&gt;最后，感谢我的同事cntrump。并附上《代码大全》里的一段话，我前些天重温的时候才看过：&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;23.2 &lt;strong&gt;寻找缺陷&lt;/strong&gt; - &lt;em&gt;同他人讨论问题&lt;/em&gt;&lt;br /&gt;
　　有人会把这种方法称之为“忏悔式调试”。当你向别人解释自己的程序时，常常能发现自己犯下的一些错误。举个例子，如果你向别人解释上面的关于薪水的例子，你或许会这样对别人说：&lt;br /&gt;
　　嗨，jennifer，你有空么？我现在遇到一个麻烦。这张员工薪水列表本来应当是按照顺序排列的，但里面有些名字乱序了。我原本打算看看是不是新输入的名字就会这种情况，但有时是对的，有时又不是。我向这些数据在我输入他们的时候就应当被排序，因为程序会在我输入数据的时候对其排序，然后在数据保存的时候再排一遍。等一下，不对，它没有在输入数据的时候对其排序。就是这里。程序只是粗略地对这些数据进行了排序。谢谢你，jennifer，你帮了我个大忙。&lt;/p&gt;
&lt;/blockquote&gt;
</description>
    </item>
    
  </channel>
</rss>